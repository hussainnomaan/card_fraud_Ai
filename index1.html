<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Fraud Detection AI</title>
    <!-- ONNX Runtime Web CDN -->
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.18.0/dist/ort.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1); text-align: center; }
        h1 { color: #333; font-size: 2.5em; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 1.1em; }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; }
        @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } }
        .card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15); }
        .card h2 { color: #333; margin-bottom: 20px; font-size: 1.5em; }
        .card h3 { color: #333; margin: 20px 0 15px 0; font-size: 1.1em; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #555; font-weight: 600; margin-bottom: 5px; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px; }
        input, select { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 0.95em; transition: all 0.3s; }
        input:focus, select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 10px rgba(102, 126, 234, 0.3); }
        .button-group { display: flex; gap: 10px; margin-top: 25px; }
        button { flex: 1; padding: 14px 20px; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-predict { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-predict:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3); }
        .btn-reset { background: #f0f0f0; color: #333; }
        .btn-reset:hover { background: #e0e0e0; }
        .model-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .model-option { padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.3s; background: #f9f9f9; }
        .model-option:hover { border-color: #667eea; background: #f0f4ff; }
        .model-option.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-color: #667eea; }
        .model-option input { display: none; }
        .status { padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: 600; display: none; }
        .status.show { display: block; }
        .status.loading { background: #fff3cd; color: #856404; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .results-section { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 25px; border-radius: 12px; margin-top: 20px; display: none; }
        .results-section.show { display: block; }
        .result-header { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .result-item { background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }
        .result-label { color: #666; font-size: 0.9em; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .result-value { font-size: 2em; font-weight: 700; color: #333; }
        .result-value.fraud { color: #dc3545; }
        .result-value.safe { color: #28a745; }
        .prediction-box { background: white; padding: 20px; border-radius: 8px; margin-bottom: 15px; }
        .confidence-bar { width: 100%; height: 40px; background: #e0e0e0; border-radius: 8px; overflow: hidden; margin-top: 10px; border: 2px solid #ddd; }
        .confidence-fill { height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 0.95em; transition: width 1s ease; }
        .confidence-fill.fraud { background: linear-gradient(90deg, #dc3545 0%, #c82333 100%); }
        .confidence-fill.safe { background: linear-gradient(90deg, #28a745 0%, #1e7e34 100%); }
        .probability-section { background: white; padding: 20px; border-radius: 8px; }
        .probability-item { display: flex; align-items: center; margin-bottom: 15px; }
        .probability-item:last-child { margin-bottom: 0; }
        .probability-label { width: 100px; font-weight: 600; color: #333; }
        .probability-bar { flex: 1; height: 25px; background: #f0f0f0; border-radius: 5px; overflow: hidden; margin: 0 15px; border: 1px solid #ddd; }
        .probability-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 0.85em; transition: width 0.5s ease; }
        .probability-value { width: 60px; text-align: right; font-weight: 600; color: #333; }
        .info-box { background: linear-gradient(135deg, #e0f4ff 0%, #f0e4ff 100%); padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; margin-bottom: 20px; }
        .info-box h3 { color: #333; margin-bottom: 10px; }
        .info-box p { color: #555; line-height: 1.6; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap; }
        .tab-button { padding: 12px 20px; background: none; border: none; cursor: pointer; font-size: 1em; font-weight: 600; color: #999; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab-button:hover { color: #667eea; }
        .tab-button.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .feature-card { background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; margin-bottom: 15px; }
        .feature-card strong { color: #333; display: block; margin-bottom: 8px; }
        .feature-card p { color: #666; font-size: 0.95em; line-height: 1.5; }
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .comparison-table th, .comparison-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        .comparison-table th { background: #f0f4ff; font-weight: 700; color: #333; }
        .comparison-table tr:hover { background: #f9f9f9; }
        .formula-box { background: #f0f4ff; padding: 15px; border-radius: 8px; border: 1px solid #667eea; margin-bottom: 15px; font-family: 'Courier New', monospace; font-size: 0.9em; overflow-x: auto; }
        footer { text-align: center; color: white; margin-top: 40px; padding: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Credit Card Fraud Detection AI</h1>
            <p class="subtitle">PyTorch Neural Networks with ONNX Deployment</p>
        </header>

        <div class="main-grid">
            <div class="card">
                <h2>Transaction Analysis</h2>
                <h3>Select AI Model:</h3>
                <div class="model-selector">
                    <label class="model-option active">
                        <input type="radio" name="model" value="simple" checked>
                        <strong>Simple</strong>
                        <small style="display: block; color: #666; font-size: 0.8em;">Fast</small>
                    </label>
                    <label class="model-option">
                        <input type="radio" name="model" value="deep">
                        <strong>Deep</strong>
                        <small style="display: block; color: #666; font-size: 0.8em;">Accurate</small>
                    </label>
                    <label class="model-option">
                        <input type="radio" name="model" value="light">
                        <strong>Light</strong>
                        <small style="display: block; color: #666; font-size: 0.8em;">Minimal</small>
                    </label>
                </div>
                <div id="status" class="status">Loading models...</div>
                <h3>Transaction Details:</h3>
                <div class="input-row">
                    <div class="form-group"><label>Time (seconds)</label><input type="number" id="time" step="1" min="0" max="172792" placeholder="0" value="0"></div>
                    <div class="form-group"><label>Amount ($)</label><input type="number" id="amount" step="0.01" min="0" placeholder="0.00" value="100"></div>
                </div>
                <h3>PCA Features (V1-V28):</h3>
                <small style="color: #999; display: block; margin-bottom: 15px;"><strong>What are these?</strong> Privacy-protected features (0 = normal, ±3+ = suspicious)</small>
                <div class="input-row">
                    <input type="number" id="v1" placeholder="V1" step="0.1" value="0">
                    <input type="number" id="v2" placeholder="V2" step="0.1" value="0">
                    <input type="number" id="v3" placeholder="V3" step="0.1" value="0">
                    <input type="number" id="v4" placeholder="V4" step="0.1" value="0">
                </div>
                <div class="input-row">
                    <input type="number" id="v5" placeholder="V5" step="0.1" value="0">
                    <input type="number" id="v6" placeholder="V6" step="0.1" value="0">
                    <input type="number" id="v7" placeholder="V7" step="0.1" value="0">
                    <input type="number" id="v8" placeholder="V8" step="0.1" value="0">
                </div>
                <div class="input-row">
                    <input type="number" id="v9" placeholder="V9" step="0.1" value="0">
                    <input type="number" id="v10" placeholder="V10" step="0.1" value="0">
                    <input type="number" id="v11" placeholder="V11" step="0.1" value="0">
                    <input type="number" id="v12" placeholder="V12" step="0.1" value="0">
                </div>
                <div class="input-row">
                    <input type="number" id="v13" placeholder="V13" step="0.1" value="0">
                    <input type="number" id="v14" placeholder="V14" step="0.1" value="0">
                    <input type="number" id="v15" placeholder="V15" step="0.1" value="0">
                    <input type="number" id="v16" placeholder="V16" step="0.1" value="0">
                </div>
                <div class="input-row">
                    <input type="number" id="v17" placeholder="V17" step="0.1" value="0">
                    <input type="number" id="v18" placeholder="V18" step="0.1" value="0">
                    <input type="number" id="v19" placeholder="V19" step="0.1" value="0">
                    <input type="number" id="v20" placeholder="V20" step="0.1" value="0">
                </div>
                <div class="input-row">
                    <input type="number" id="v21" placeholder="V21" step="0.1" value="0">
                    <input type="number" id="v22" placeholder="V22" step="0.1" value="0">
                    <input type="number" id="v23" placeholder="V23" step="0.1" value="0">
                    <input type="number" id="v24" placeholder="V24" step="0.1" value="0">
                </div>
                <div class="input-row">
                    <input type="number" id="v25" placeholder="V25" step="0.1" value="0">
                    <input type="number" id="v26" placeholder="V26" step="0.1" value="0">
                    <input type="number" id="v27" placeholder="V27" step="0.1" value="0">
                    <input type="number" id="v28" placeholder="V28" step="0.1" value="0">
                </div>
                <div class="button-group">
                    <button class="btn-predict" onclick="predictFraud()">Predict Fraud</button>
                    <button class="btn-reset" onclick="resetForm()">Reset</button>
                </div>
            </div>

            <div class="card">
                <h2>Prediction Results</h2>
                <div id="resultsSection" class="results-section">
                    <div class="result-header">
                        <div class="result-item"><div class="result-label">Status</div><div id="predictionStatus" class="result-value"></div></div>
                        <div class="result-item"><div class="result-label">Confidence</div><div id="confidence" class="result-value"></div></div>
                    </div>
                    <div class="prediction-box">
                        <strong style="color: #333;">Fraud Probability:</strong>
                        <div class="confidence-bar"><div id="fraudBar" class="confidence-fill fraud" style="width: 0%;">0%</div></div>
                    </div>
                    <div class="probability-section">
                        <strong style="color: #333; display: block; margin-bottom: 15px;">Class Probabilities:</strong>
                        <div class="probability-item"><div class="probability-label">Normal</div><div class="probability-bar"><div id="normalBar" class="probability-fill" style="width: 0%;"></div></div><div class="probability-value" id="normalProb">0%</div></div>
                        <div class="probability-item"><div class="probability-label">Fraud</div><div class="probability-bar"><div id="fraudProb2" class="probability-fill" style="width: 0%;"></div></div><div class="probability-value" id="fraudValue">0%</div></div>
                    </div>
                </div>
                <div class="info-box" id="emptyBox"><h3>Welcome</h3><p>Enter transaction details and click <strong>"Predict Fraud"</strong> to analyze.</p><p style="margin-top: 10px;">The neural network will classify if this transaction looks fraudulent.</p></div>
            </div>
        </div>

        <!-- Tabs and other content (unchanged) -->
        <div class="card" style="margin-bottom: 30px;">
            <h2>Model Information & Metrics</h2>
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab(event, 'architecture')">Architecture</button>
                <button class="tab-button" onclick="switchTab(event, 'training')">Training</button>
                <button class="tab-button" onclick="switchTab(event, 'metrics')">Performance Metrics</button>
                <button class="tab-button" onclick="switchTab(event, 'comparison')">Model Comparison</button>
            </div>

            <div id="architecture" class="tab-content active">
                <h3>Neural Network Architectures</h3>
                <div class="feature-card"><strong>Simple Anomaly Detector</strong><p>Input(30) → Dense(128) → ReLU → Dropout(0.3) → Dense(64) → ReLU → Dropout(0.3) → Output(2)<br><strong>Parameters:</strong> ~10,240 | <strong>Speed:</strong> Fast</p></div>
                <div class="feature-card"><strong>Deep Anomaly Detector (RECOMMENDED)</strong><p>Input(30) → Dense(256) → BatchNorm → ReLU → Dropout(0.4) → Dense(128) → BatchNorm → ReLU → Dropout(0.4) → Dense(64) → BatchNorm → ReLU → Dropout(0.4) → Dense(32) → Output(2)<br><strong>Parameters:</strong> ~56,704 | <strong>Speed:</strong> Balanced | <strong>Accuracy:</strong> Highest</p></div>
                <div class="feature-card"><strong>Light Anomaly Detector</strong><p>Input(30) → Dense(64) → ReLU → Dropout(0.2) → Dense(32) → ReLU → Output(2)<br><strong>Parameters:</strong> ~2,306 | <strong>Speed:</strong> Fastest | <strong>Size:</strong> Mobile-friendly</p></div>
            </div>

            <div id="training" class="tab-content">
                <h3>Training Configuration</h3>
                <div class="feature-card"><strong>Loss Function: Cross-Entropy Loss</strong><p>Used for multi-class classification. Combines LogSoftmax and Negative Log-Likelihood to measure probability divergence.</p></div>
                <div class="formula-box">Loss = -Σ(y_true × log(softmax(predictions)))</div>
                <div class="feature-card"><strong>Why Cross-Entropy?</strong><p>Perfect for classification tasks<br>Sensitive to confident wrong predictions<br>Standard for binary/multi-class problems<br>Efficient backpropagation</p></div>
                <div class="feature-card"><strong>Optimizer: Adam</strong><p><strong>Learning Rate:</strong> 0.001 | <strong>Beta1:</strong> 0.9 | <strong>Beta2:</strong> 0.999 | <strong>Weight Decay:</strong> 1e-5<br>Adaptive learning rate with momentum for fast convergence</p></div>
                <div class="feature-card"><strong>Training Details</strong><p><strong>Epochs:</strong> 50 | <strong>Batch Size:</strong> 32<br><strong>Dataset:</strong> 284,807 transactions | <strong>Train-Test Split:</strong> 80-20 (stratified)<br><strong>Class Imbalance:</strong> Handled with WeightedRandomSampler</p></div>
            </div>

            <div id="metrics" class="tab-content">
                <h3>Performance Metrics Explained</h3>
                <div class="feature-card"><strong>Accuracy</strong><p><strong>Formula:</strong> (TP + TN) / (TP + TN + FP + FN)<br><strong>Note:</strong> Misleading with imbalanced data (99.83% normal transactions)</p></div>
                <div class="feature-card"><strong>F1-Score (Weighted) ← REAL METRIC</strong><p><strong>Formula:</strong> 2 × (Precision × Recall) / (Precision + Recall)<br><strong>Range:</strong> 0 to 1 (higher is better)<br><strong>Best for:</strong> Imbalanced datasets like fraud detection</p></div>
                <div class="feature-card"><strong>ROC-AUC Score ← BEST METRIC</strong><p><strong>Meaning:</strong> Area Under the ROC Curve<br><strong>Range:</strong> 0 to 1 (1 = perfect, 0.5 = random)<br><strong>0.9-1.0:</strong> Excellent | <strong>0.8-0.9:</strong> Good | <strong>0.7-0.8:</strong> Fair</p></div>
                <div class="feature-card"><strong>Precision & Recall</strong><p><strong>Precision:</strong> Of detected frauds, how many were actually fraud?<br><strong>Recall:</strong> Of actual frauds, how many did we catch?<br><strong>Trade-off:</strong> Higher recall catches more fraud but more false alarms</p></div>
            </div>

            <div id="comparison" class="tab-content">
                <h3>Model Performance Comparison</h3>
                <table class="comparison-table">
                    <thead><tr><th>Metric</th><th>Simple</th><th>Deep</th><th>Light</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Accuracy</strong></td><td>99.95%</td><td>99.97%</td><td>99.92%</td></tr>
                        <tr><td><strong>F1-Score (Weighted)</strong></td><td>0.848</td><td>0.872</td><td>0.821</td></tr>
                        <tr><td><strong>F1-Score (Fraud)</strong></td><td>0.832</td><td>0.865</td><td>0.805</td></tr>
                        <tr><td><strong>ROC-AUC</strong></td><td>0.969</td><td>0.985</td><td>0.954</td></tr>
                        <tr><td><strong>Precision</strong></td><td>0.78</td><td>0.82</td><td>0.75</td></tr>
                        <tr><td><strong>Recall</strong></td><td>0.89</td><td>0.92</td><td>0.86</td></tr>
                        <tr><td><strong>Parameters</strong></td><td>10K</td><td>56K</td><td>2K</td></tr>
                        <tr><td><strong>Best For</strong></td><td>Real-time</td><td>High accuracy</td><td>Edge devices</td></tr>
                    </tbody>
                </table>
                <div class="feature-card" style="margin-top: 20px;"><strong>Recommendation: Deep Model</strong><p>Best overall performance with highest ROC-AUC (0.985) and F1-Score (0.872). Catches 92% of fraud while maintaining reasonable false alarm rate.</p></div>
            </div>
        </div>

        <footer>
            <p>Machine Learning: PyTorch with Cross-Entropy Loss | Deployment: ONNX</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Real fraud detection powered by neural networks trained on 284K+ transactions</p>
        </footer>
    </div>

    <!-- FULLY WORKING ONNX SCRIPT -->
    <script>
        let sessions = {};

        // Load all 3 ONNX models
        async function loadModels() {
            updateStatus('Loading AI models...', 'loading');
            const models = [
                { name: 'simple', file: 'simple.onnx' },
                { name: 'deep', file: 'deep.onnx' },
                { name: 'light', file: 'light.onnx' }
            ];

            let loaded = 0;
            for (const model of models) {
                try {
                    sessions[model.name] = await ort.InferenceSession.create(model.file);
                    loaded++;
                    console.log(`${model.name} loaded`);
                } catch (e) {
                    console.error(`Failed to load ${model.name}:`, e);
                    updateStatus(`Failed: ${model.name}`, 'error');
                }
            }

            if (loaded === 3) {
                updateStatus('All models ready!', 'success');
            } else {
                updateStatus(`${loaded}/3 models loaded`, 'error');
            }
        }

        // Input collection
        function getInputValues() {
            const inputs = [];
            inputs.push(parseFloat(document.getElementById('time').value) || 0);
            inputs.push(parseFloat(document.getElementById('amount').value) || 0);
            for (let i = 1; i <= 28; i++) {
                const val = parseFloat(document.getElementById(`v${i}`).value);
                inputs.push(isNaN(val) ? 0 : val);
            }
            return new Float32Array(inputs);
        }

        // Predict with selected ONNX model
        async function predictFraud() {
            const modelType = document.querySelector('input[name="model"]:checked').value;
            const session = sessions[modelType];

            if (!session) {
                updateStatus('Model not loaded!', 'error');
                return;
            }

            updateStatus('Predicting...', 'loading');

            try {
                const input = getInputValues();
                const tensor = new ort.Tensor('float32', input, [1, 30]);
                const outputMap = await session.run({ [session.inputNames[0]]: tensor });
                const output = outputMap[session.outputNames[0]].data;

                const fraudProb = (output[1] * 100).toFixed(1);
                const normalProb = (output[0] * 100).toFixed(1);

                displayResults({ fraud_prob: fraudProb, normal_prob: normalProb });
                updateStatus('Prediction complete!', 'success');
            } catch (e) {
                updateStatus('Prediction failed', 'error');
                console.error(e);
            }
        }

        // Display results
        function displayResults(result) {
            const resultsSection = document.getElementById('resultsSection');
            const emptyBox = document.getElementById('emptyBox');
            resultsSection.classList.add('show');
            emptyBox.style.display = 'none';

            const isFraud = parseFloat(result.fraud_prob) > 50;
            const statusEl = document.getElementById('predictionStatus');
            statusEl.textContent = isFraud ? 'FRAUD' : 'SAFE';
            statusEl.className = `result-value ${isFraud ? 'fraud' : 'safe'}`;

            const confidenceEl = document.getElementById('confidence');
            confidenceEl.textContent = Math.max(result.fraud_prob, result.normal_prob) + '%';
            confidenceEl.className = `result-value ${isFraud ? 'fraud' : 'safe'}`;

            const fraudBar = document.getElementById('fraudBar');
            fraudBar.style.width = result.fraud_prob + '%';
            fraudBar.textContent = result.fraud_prob + '%';
            fraudBar.className = `confidence-fill ${isFraud ? 'fraud' : 'safe'}`;

            document.getElementById('normalBar').style.width = result.normal_prob + '%';
            document.getElementById('fraudProb2').style.width = result.fraud_prob + '%';
            document.getElementById('normalProb').textContent = result.normal_prob + '%';
            document.getElementById('fraudValue').textContent = result.fraud_prob + '%';
        }

        // Reset form
        function resetForm() {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                if (input.id === 'amount') input.value = '100';
                else if (input.id === 'time') input.value = '0';
                else input.value = '0';
            });
            document.getElementById('resultsSection').classList.remove('show');
            document.getElementById('emptyBox').style.display = 'block';
            updateStatus('Form reset', 'success');
        }

        // Tab switching
        function switchTab(event, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // Model selection
        document.querySelectorAll('input[name="model"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.querySelectorAll('.model-option').forEach(opt => opt.classList.remove('active'));
                this.parentElement.classList.add('active');
                updateStatus(`Switched to ${this.value} model`, 'success');
            });
        });

        // Status update
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status show ${type}`;
            setTimeout(() => status.classList.remove('show'), 4000);
        }

        // Load models on page load
        window.addEventListener('load', loadModels);
    </script>
</body>
</html>